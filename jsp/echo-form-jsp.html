<!DOCTYPE html>
<html>
<head>
    <title>JSP Echo Form</title>
</head>
<body>

    <h3>JSP Echo Form (Barebones)</h3>

    <form id="echoForm" action="/java/echo.jsp" method="POST">
        Method:
        <select id="httpMethod">
            <option value="GET">GET</option>
            <option value="POST" selected>POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
        </select>
        <br>

        Encoding:
        <select id="encodingType">
            <option value="application/x-www-form-urlencoded">URL Encoded</option>
            <option value="application/json">JSON</option>
        </select>
        <br>

        Data:
        <input type="text" id="userData" name="userData" value="Test Data">
        <br><br>

        <button type="submit">Submit to Java</button>
    </form>

    <hr>
    <h4>Response:</h4>
    <iframe name="responseTarget" id="responseTarget" width="100%" height="200px"></iframe>

    <script>
        const form = document.getElementById('echoForm');

        form.addEventListener('submit', function(event) {
            const method = document.getElementById('httpMethod').value;
            const encoding = document.getElementById('encodingType').value;
            const data = document.getElementById('userData').value;
            const targetURL = "/java/echo.jsp";

            if (encoding === 'application/json' || method === 'PUT' || method === 'DELETE') {
                event.preventDefault();

                let bodyData;
                if (encoding === 'application/json') {
                    bodyData = JSON.stringify({ "input": data });
                } else {
                    bodyData = new URLSearchParams(new FormData(form)).toString();
                }

                fetch(targetURL, {
                    method: method,
                    headers: { 'Content-Type': encoding },
                    body: (method !== 'GET') ? bodyData : null
                })
                .then(res => res.text())
                .then(html => {
                    const doc = document.getElementById('responseTarget').contentWindow.document;
                    doc.open();
                    doc.write(html);
                    doc.close();
                });
            } else {
                form.method = method;
                form.target = "responseTarget";
            }
        });
    </script>

</body>
</html>